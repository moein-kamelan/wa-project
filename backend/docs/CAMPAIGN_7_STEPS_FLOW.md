# 📱 Campaign 7-Step Flow

## فرآیند 7 مرحله‌ای ایجاد و اجرای کمپین

### **🎯 مراحل کمپین:**

#### **مرحله 1: تعریف کمپین و متن پیام**
- ✅ ایجاد کمپین با متن پیام
- ✅ وضعیت: `draft`

#### **مرحله 2: آپلود فایل اکسل برای هر کمپین**
- ✅ آپلود فایل Excel با شماره‌های تلفن
- ✅ وضعیت: `ready`

#### **مرحله 3: افزودن فایل ضمیمه سراسری (اختیاری)**
- ✅ آپلود فایل ضمیمه (تصویر، PDF، ...)
- ✅ ارسال به همراه پیام برای همه

#### **مرحله 4: تنظیمات وقفه ارسال**
- ✅ انتخاب فاصله ارسال (5s, 10s, 20s)
- ✅ آماده برای اتصال WhatsApp

#### **مرحله 5: اتصال حساب WhatsApp**
- ✅ تولید QR کد
- ✅ اسکن QR کد با گوشی
- ✅ اتصال موفق

#### **مرحله 6: در حال ارسال پیام‌ها**
- ✅ شروع ارسال
- ✅ نمایش پیشرفت real-time
- ✅ وضعیت: `running`

#### **مرحله 7: نشان دادن گزارش نهایی**
- ✅ تکمیل ارسال
- ✅ گزارش کامل
- ✅ وضعیت: `completed`

---

## 🔧 API Endpoints برای هر مرحله:

### **مرحله 1: تعریف کمپین**
```bash
POST /api/campaigns
{
  "message": "سلام! پیشنهاد ویژه برای شما..."
}
```

### **مرحله 2: آپلود گیرندگان**
```bash
POST /api/campaigns/:campaignId/recipients
# multipart/form-data with Excel file
```

### **مرحله 3: آپلود ضمیمه**
```bash
POST /api/campaigns/:campaignId/attachment
# multipart/form-data with file
```

### **مرحله 4: تنظیم وقفه**
```bash
PUT /api/campaigns/:campaignId/interval
{
  "interval": "10s"
}
```

### **مرحله 5: اتصال WhatsApp**
```bash
POST /api/campaigns/:campaignId/qr-code
GET /api/campaigns/:campaignId/connection
```

### **مرحله 6: شروع ارسال**
```bash
POST /api/campaigns/:campaignId/start
GET /api/campaigns/:campaignId/progress
```

### **مرحله 7: گزارش نهایی**
```bash
GET /api/campaigns/:campaignId/report
GET /api/campaigns/:campaignId/report/download
```

---

## 📊 وضعیت‌های کمپین:

| وضعیت | توضیح | مرحله |
|-------|-------|--------|
| `draft` | کمپین ایجاد شده | 1 |
| `ready` | گیرندگان آپلود شدند | 2 |
| `ready` | ضمیمه آپلود شد (اختیاری) | 3 |
| `ready` | وقفه تنظیم شد | 4 |
| `ready` | WhatsApp متصل شد | 5 |
| `running` | در حال ارسال | 6 |
| `completed` | تکمیل شده | 7 |

---

## 🎮 UI Flow:

### **صفحه 1: تعریف کمپین**
- فیلد متن پیام
- دکمه "ادامه"

### **صفحه 2: آپلود گیرندگان**
- آپلود فایل Excel
- پیش‌نمایش گیرندگان
- دکمه "ادامه"

### **صفحه 3: ضمیمه (اختیاری)**
- آپلود فایل ضمیمه
- دکمه "ادامه" یا "رد کردن"

### **صفحه 4: تنظیم وقفه**
- انتخاب فاصله (5s, 10s, 20s)
- دکمه "ادامه"

### **صفحه 5: اتصال WhatsApp**
- نمایش QR کد
- راهنمای اسکن
- دکمه "بررسی اتصال"

### **صفحه 6: ارسال**
- نمایش پیشرفت
- دکمه "توقف" (اختیاری)
- نمایش آمار real-time

### **صفحه 7: گزارش**
- آمار نهایی
- دکمه "دانلود گزارش"
- دکمه "کمپین جدید"

---

## 🔄 WebSocket Events:

### **مرحله 5: اتصال WhatsApp**
```json
{
  "type": "qr_code",
  "campaignId": "campaign_id",
  "qrCode": "data:image/png;base64,..."
}
```

### **مرحله 6: پیشرفت ارسال**
```json
{
  "type": "progress",
  "campaignId": "campaign_id",
  "data": {
    "sent": 45,
    "total": 150,
    "current": "09120000000"
  }
}
```

### **مرحله 7: تکمیل**
```json
{
  "type": "completion",
  "campaignId": "campaign_id",
  "data": {
    "status": "completed",
    "totalSent": 148,
    "totalFailed": 2
  }
}
```

---

## ✅ مزایای این فرآیند:

1. **منطقی:** هر مرحله وابسته به مرحله قبل است
2. **کاربرپسند:** UI ساده و قابل فهم
3. **انعطاف:** امکان بازگشت به مراحل قبل
4. **کنترل:** کاربر کنترل کامل دارد
5. **شفاف:** وضعیت کمپین همیشه مشخص است

---

## 🎯 نتیجه:

این فرآیند 7 مرحله‌ای کاملاً منطقی و کاربرپسند است و API موجود از آن پشتیبانی می‌کند!
